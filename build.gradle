plugins {
    id 'java'
    id 'application'
    id("io.freefair.lombok") version "8.13.1"
    id("com.osmerion.lwjgl3") version "0.5.0"
}

group = 'com.james090500'
version = '1.0-SNAPSHOT'

repositories {
    mavenCentral()
    maven {
        url "https://oss.sonatype.org/content/repositories/snapshots/"
    }
}

dependencies {
    implementation "org.joml:joml:1.10.8"
    implementation 'org.lz4:lz4-java:1.8.0'
}

/**
 * Application plugin:
 * - installDist / distZip produce:
 *   build/install/<project>/{bin,lib} and build/distributions/<project>.zip
 * - lib/ contains your jar + all runtime deps (including LWJGL + natives)
 */
application {
    // Gradle 8 syntax
    mainClass = 'com.james090500.BlockGame'

    // Ensure the distribution (distZip/distTar) doesn't choke on duplicates
    distributions {
        main {
            contents {
                duplicatesStrategy = DuplicatesStrategy.EXCLUDE
            }
        }
    }
}

// Also set a global duplicate strategy for archive tasks (zip/tar)
tasks.withType(org.gradle.api.tasks.bundling.AbstractArchiveTask).configureEach {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

// (Optional) If you have any custom Copy tasks, keep this too
tasks.withType(Copy).configureEach {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

lwjgl3 {
    targets.named("main") {
        // Modules
        modules.add("lwjgl")
        modules.add("lwjgl-glfw")
        modules.add("lwjgl-opengl")
        modules.add("lwjgl-stb")
        modules.add("lwjgl-nanovg")

        // Platforms (includes natives for each target)
        macosARM64()
        macosX64()
        windowsX64()
        linuxX64()
    }
}